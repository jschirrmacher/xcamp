<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>XCamp 2018 Ticket</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <base href="{{baseUrl}}">
    <link rel="stylesheet" href="ticket.css">
</head>
<body>
{{> menu}}
{{> logo}}
<div id="main">
<div class="container">
    <form class="ticket" id="{{access_code}}">
        {{> ticketHeader}}
        {{> ticketData}}

        <button class="printTicket noprint" onclick="window.print()">Drucken</button>
        <button class="saveTicket noprint" onclick="">Änderungen speichern</button>
    </form>

    <p class="noprint">
        Du kannst vor dem Event jederzeit dein Ticket übertragen, indem du den Namen und die E-Mail-Adresse des
        neuen Teilnehmers einträgst und auf "Änderungen speichern" klickst. Der Teilnehmer / die Teilnehmerin erhält
        dann das Ticket an seine / ihre E-Mail-Adresse.
    </p>
    <p class="noprint">
        Der ursprüngliche Käufer des Tickets hat über den Link, der ihm / ihr nach dem Kauf zugesendet wurde,
        auch weiterhin Zugriff auf das Ticket. Das ist notwendig, um ggf. eine falsch eingebene E-Mail-Adresse bei der
        Übertragung des Tickets auf eine andere Person korrigieren zu können.
    </p>
</div>
</div>
{{> footer}}

<script src="qrcode/qrcode.min.js"></script>
<script src="common.js"></script>
<script>
    [].forEach.call(document.getElementsByClassName('ticketNo'), function (el) {
        QRCode.toCanvas(el, '{{baseUrl}}ticket/' + el.id)
    })
        {{#print}}
        window.print()
        window.onafterprint = function () {
            window.close()
        }
        {{/print}}

    bindHandler('saveTicket', 'click', function (button) {
        const options = encodeParams({
            firstName: button.form.elements['participant_firstName'].value,
            lastName: button.form.elements['participant_lastName'].value,
            email: button.form.elements['participant_email'].value,
        }, {method: 'PUT'})
        fetchReload('tickets/' + button.form.id, options)
    })
</script>
</body>
</html>
